!function(t){t.module("sistemiumAngularAuth.config",[]).value("sistemiumAngularAuth.config",{debug:!0}),t.module("sistemiumAngularAuth.services",[]),t.module("sistemiumAngularAuth",["sistemium.schema","sistemium.util","ui.router","LocalStorageModule","sistemiumAngularAuth.config","sistemiumAngularAuth.services","sistemiumAngularAuth.models"]).config(function(t){t.interceptors.push("saAuthInterceptor")})}(angular),function(t){"use strict";t.module("sistemiumAngularAuth.models",["sistemiumAngularAuth.services"])}(angular),function(){"use strict";function t(t,n,e){return{request:function(t){var n=e.get();return t.headers=t.headers||{},n&&(t.headers.authorization=n),t},responseError:function(u){return(401===u.status||403===u.status)&&(n.get("$state").go("debt.login"),e.destroy()),t.reject(u)}}}angular.module("sistemiumAngularAuth").factory("saAuthInterceptor",t)}(),function(t){"use strict";t.module("sistemiumAngularAuth.models").run(function(t,n){t.register({name:"saAccount",endpoint:"/account",basePath:n.authApiUrl,relations:{hasMany:{providerAccount:{localField:"providers",foreignKey:"accountId"}}}})})}(angular),function(t){"use strict";t.module("sistemiumAngularAuth.models").config(function(){})}(angular),function(t){"use strict";t.module("sistemiumAngularAuth.models").constant("saaAppConfig",{apiUrl:"http://localhost:9080/api/"})}(angular),function(){"use strict";angular.module("sistemiumAngularAuth.models").run(function(t,n){t.register({name:"saProviderAccount",basePath:n.apiUrl})})}(),function(){function t(t,n){var e="access-token",u=t.get(e);return n.$on("logged-off",function(){u=void 0}),{get:function(){return u},save:function(n){u=n,t.set(e,n)},destroy:function(){t.remove(e)}}}angular.module("sistemiumAngularAuth.models").service("saToken",t)}(),function(){function t(t,n,e,u,r,o,a){var i,s=r.safeCb,c={},l=o.model("saAccount");u.get()&&"/logout"!==t.path()&&(c=l.find("me"),c.then(function(t){l.loadRelations(t,["saProviderAccount"]).then(function(){c=t}),console.log("logged-in",t),a.$broadcast("logged-in")}));var g={loginWithMobileNumber:function(t){return n.get(g.config.phaUrl+t)},authWithSmsCode:function(t,e){return n.get(g.config.authUrl+"/auth/pha/"+t+"/"+e).then(function(t){var n=t.headers("x-access-token");return{token:n,user:t.data}})},login:function(t,r){return n.get(g.config.authUrl+"/api/token/"+t,{headers:{authorization:t}}).then(function(n){n.data&&n.data.tokenInfo&&n.data.tokenInfo.id;u.save(t),l.find("me").then(function(t){return c=t,s(r)(null,c),a.$broadcast("logged-in"),c}).catch(function(t){console.log(t)})}).catch(function(t){return g.logout(),s(r)(t.data),e.reject(t.data)})},logout:function(){u.destroy(),c={},a.$broadcast("logged-off")},createUser:function(t,n){return l.create(t).then(function(e){return u.save(e.token),c=l.find("me"),s(n)(null,t)},function(t){return g.logout(),s(n)(t)})},getCurrentUser:function(t){if(0===arguments.length)return c;var n=c.hasOwnProperty("$$state")?c:c;return e.when(n).then(function(n){return s(t)(n),n},function(){return s(t)({}),{}})},isLoggedIn:function(t){return 0===arguments.length?c.hasOwnProperty("roles"):g.getCurrentUser(null).then(function(n){var e=n.hasOwnProperty("roles");return s(t)(e),e})},hasRole:function(t,n){var e=function(t,n){return i=g.config.userRoles||[],i.indexOf(t)>=i.indexOf(n)};return arguments.length<2?e(c.role,t):g.getCurrentUser(null).then(function(u){var r=u.hasOwnProperty("roles")?e(u.roles,t):!1;return s(n)(r),r})},isAdmin:function(){return g.hasRole.apply(g,[].concat.apply(["admin"],arguments))},getToken:function(){return u.get()}};return function(t){return g.config=t,g}}angular.module("sistemiumAngularAuth.services").factory("saAuth",t)}(),angular.module("sistemiumAngularAuth.services",["sistemium.schema"]).service("Schema",function(t,n){return t({getCount:function(t){var e=this,u=e.getAdapter("http").defaults.basePath;return n.get(u+"/"+e.endpoint,{params:angular.extend({"agg:":"count"},t||{})}).then(function(t){return parseInt(t.headers("x-aggregate-count"))||t.data&&t.data.count})},getList:function(t){return this.findAll(t,{bypassCache:!0})}})});